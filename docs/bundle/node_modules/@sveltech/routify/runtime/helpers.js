import{get_store_value as e,getContext as t}from"../../../svelte/internal/index.mjs.js";import{writable as n,derived as r}from"../../../svelte/store/index.mjs.js";import{pathToParamKeys as i}from"./utils/index.js";import{rootContext as o,route as s,routes as c,location as a}from"./store.js";import p from"../runtime.config.js";import"./Prefetcher.svelte.js";function l(){return t("routify")||o}const u={_hooks:[],subscribe:d},m={_hooks:[],subscribe:d};function d(e){const t=this._hooks,n=t.length;return e((e=>{t[n]=e})),()=>delete t[n]}const f={subscribe(e){const t=l();return r([t,s,c,a],(e=>g(...e))).subscribe(e)}};function g(e,t,n,r){return function(o,s,c){const{component:a}=e;o=o||"./";if(c&&!1!==c.strict||(o=o.replace(/index$/,"")),o.match(/^\.\.?\//)){let[,e,t]=o.match(/^([\.\/]+)(.*)/),n=a.path.replace(/\/$/,"");(e.match(/\.\.\//g)||[]).forEach((()=>n=n.replace(/\/[^\/]+\/?$/,""))),o=`${n}/${t}`.replace(/\/$/,"")}else if(o.match(/^\//));else{const e=n.find((e=>e.meta.name===o));e&&(o=e.shortPath)}const l=Object.assign({},t.params,a.params,s);let u=o;for(const[e,t]of Object.entries(l))u=u.replace(":"+e,t);return(r.base+u+function(e,t){if(!p.queryHandler)return"";const n=i(e),r={};t&&Object.entries(t).forEach((([e,t])=>{n.includes(e)||(r[e]=t)}));return p.queryHandler.stringify(r)}(o,s)).replace(/\?$/,"")}}const h={subscribe:e=>r([f,s],(([e,t])=>function(n="",r={},{strict:i}={strict:!0}){n=e(n,null,{strict:i});const o=e(t.path,null,{strict:i}),s=new RegExp("^"+n+"($|/)");return!!o.match(s)})).subscribe(e)},b={props:{},templates:{},services:{plain:{propField:"name",valueField:"content"},twitter:{propField:"name",valueField:"content"},og:{propField:"property",valueField:"content"}},plugins:[{name:"applyTemplate",condition:()=>!0,action:(e,t)=>[e,(b.getLongest(b.templates,e)||(e=>e))(t)]},{name:"createMeta",condition:()=>!0,action(e,t){b.writeMeta(e,t)}},{name:"createOG",condition:e=>!e.match(":"),action(e,t){b.writeMeta("og:"+e,t)}},{name:"createTitle",condition:e=>"title"===e,action(e,t){document.title=t}}],getLongest(t,n){const r=t[n];if(r){const i=e(s).path;return r[Object.keys(t[n]).filter((e=>i.includes(e))).sort(((e,t)=>t.length-e.length))[0]]}},writeMeta(e,t){const n=document.getElementsByTagName("head")[0],r=e.match(/(.+)\:/),i=r&&r[1]||"plain",{propField:o,valueField:s}=y.services[i]||y.services.plain,c=document.querySelector(`meta[${o}='${e}']`);c&&c.remove();const a=document.createElement("meta");a.setAttribute(o,e),a.setAttribute(s,t),a.setAttribute("data-origin","routify"),n.appendChild(a)},set(e,t){b.plugins.forEach((n=>{n.condition(e,t)&&([e,t]=n.action(e,t)||[e,t])}))},clear(){const e=document.querySelector("meta");e&&e.remove()},template(e,t){const n=b.getOrigin();b.templates[e]=b.templates[e]||{},b.templates[e][n]=t},update(){Object.keys(b.props).forEach((e=>{let t=b.getLongest(b.props,e);b.plugins.forEach((n=>{n.condition(e,t)&&([e,t]=n.action(e,t)||[e,t])}))}))},batchedUpdate(){b._pendingUpdate||(b._pendingUpdate=!0,setTimeout((()=>{b._pendingUpdate=!1,this.update()})))},_updateQueued:!1,getOrigin(){const t=l();return t&&e(t).path||"/"},_pendingUpdate:!1},y=new Proxy(b,{set(e,t,n,r){const{props:i,getOrigin:o}=e;return Reflect.has(e,t)?Reflect.set(e,t,n,r):(i[t]=i[t]||{},i[t][o()]=n),window.routify.appLoaded&&e.batchedUpdate(),!0}}),j=function(){const e=n(!1);return m.subscribe((t=>t((t=>(e.set(!0),!0))))),u.subscribe((t=>t((t=>e.set(!1))))),e}();export{u as afterPageLoad,m as beforeUrlChange,h as isActive,j as isChangingPage,g as makeUrlHelper,y as metatags,f as url};
//# sourceMappingURL=helpers.js.map
