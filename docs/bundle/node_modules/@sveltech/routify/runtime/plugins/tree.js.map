{"version":3,"file":"tree.js","sources":["../../../../../../../node_modules/@sveltech/routify/runtime/plugins/tree.js"],"sourcesContent":["import { createNodeMiddleware } from '../middleware'\nimport { pathToParamKeys, pathToRank, pathToRegex } from '../utils'\n\nexport const setRegex = createNodeMiddleware(({ file }) => {\n    if (file.isPage || file.isFallback)\n        file.regex = pathToRegex(file.path, file.isFallback)\n})\nexport const setParamKeys = createNodeMiddleware(({ file }) => {\n    file.paramKeys = pathToParamKeys(file.path)\n})\n\nexport const setShortPath = createNodeMiddleware(({ file }) => {\n    if (file.isFallback || file.isIndex)\n        file.shortPath = file.path.replace(/\\/[^/]+$/, '')\n    else file.shortPath = file.path\n})\nexport const setRank = createNodeMiddleware(({ file }) => {\n    file.ranking = pathToRank(file)\n})\n\n\n// todo delete?\nexport const addMetaChildren = createNodeMiddleware(({ file }) => {\n    const node = file\n    const metaChildren = file.meta && file.meta.children || []\n    if (metaChildren.length) {\n        node.children = node.children || []\n        node.children.push(...metaChildren.map(meta => ({ isMeta: true, ...meta, meta })))\n    }\n})\n\nexport const setIsIndexable = createNodeMiddleware(payload => {\n    const { file } = payload\n    const { isLayout, isFallback, meta } = file\n    file.isIndexable = !isLayout && !isFallback && meta.index !== false\n    file.isNonIndexable = !file.isIndexable\n})\n\n\nexport const assignRelations = createNodeMiddleware(({ file, parent }) => {\n    Object.defineProperty(file, 'parent', { get: () => parent })\n    Object.defineProperty(file, 'nextSibling', { get: () => _getSibling(file, 1) })\n    Object.defineProperty(file, 'prevSibling', { get: () => _getSibling(file, -1) })\n    Object.defineProperty(file, 'lineage', { get: () => _getLineage(parent) })\n})\n\nfunction _getLineage(node, lineage = []){\n    if(node){\n        lineage.unshift(node)\n        _getLineage(node.parent, lineage)\n    }\n    return lineage\n}\n\n/**\n * \n * @param {RouteNode} file \n * @param {Number} direction \n */\nfunction _getSibling(file, direction) {\n    if (!file.root) {\n        const siblings = file.parent.children.filter(c => c.isIndexable)\n        const index = siblings.indexOf(file)\n        return siblings[index + direction]\n    }\n}\n\nexport const assignIndex = createNodeMiddleware(({ file, parent }) => {\n    if (file.isIndex) Object.defineProperty(parent, 'index', { get: () => file })\n    if (file.isLayout)\n        Object.defineProperty(parent, 'layout', { get: () => file })\n})\n\nexport const assignLayout = createNodeMiddleware(({ file, scope }) => {\n    Object.defineProperty(file, 'layouts', { get: () => getLayouts(file) })\n    function getLayouts(file) {\n        const { parent } = file\n        const layout = parent && parent.layout\n        const isReset = layout && layout.isReset\n        const layouts = (parent && !isReset && getLayouts(parent)) || []\n        if (layout) layouts.push(layout)\n        return layouts\n    }\n})\n\n\nexport const createFlatList = treePayload => {\n    createNodeMiddleware(payload => {\n        if (payload.file.isPage || payload.file.isFallback)\n        payload.state.treePayload.routes.push(payload.file)\n    }).sync(treePayload)    \n    treePayload.routes.sort((c, p) => (c.ranking >= p.ranking ? -1 : 1))\n}\n\nexport const setPrototype = createNodeMiddleware(({ file }) => {\n    const Prototype = file.root\n        ? Root\n        : file.children\n            ? file.isFile ? PageDir : Dir\n            : file.isReset\n                ? Reset\n                : file.isLayout\n                    ? Layout\n                    : file.isFallback\n                        ? Fallback\n                        : Page\n    Object.setPrototypeOf(file, Prototype.prototype)\n\n    function Layout() { }\n    function Dir() { }\n    function Fallback() { }\n    function Page() { }\n    function PageDir() { }\n    function Reset() { }\n    function Root() { }\n})\n"],"names":["setRegex","createNodeMiddleware","file","isPage","isFallback","regex","pathToRegex","path","setParamKeys","paramKeys","pathToParamKeys","setShortPath","isIndex","shortPath","replace","setRank","ranking","pathToRank","addMetaChildren","node","metaChildren","meta","children","length","push","map","isMeta","setIsIndexable","payload","isLayout","isIndexable","index","isNonIndexable","assignRelations","parent","Object","defineProperty","get","_getSibling","_getLineage","lineage","unshift","direction","root","siblings","filter","c","indexOf","assignIndex","assignLayout","scope","getLayouts","layout","isReset","layouts","createFlatList","treePayload","state","routes","sync","sort","p","setPrototype","Prototype","isFile","setPrototypeOf","prototype"],"mappings":"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"}