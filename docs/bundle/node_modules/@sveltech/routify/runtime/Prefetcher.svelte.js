import{get_store_value as e,SvelteComponent as t,init as r,safe_not_equal as n,element as o,attr as s,insert as i,detach as l,set_style as c,update_keyed_each as f,noop as u,component_subscribe as d,destroy_block as a}from"../../../svelte/internal/index.mjs.js";import{derived as m,writable as p}from"../../../svelte/store/index.mjs.js";function h(e,t,r){const n=e.slice();return n[1]=t[r],n}function w(e,t){let r,n;return{key:e,first:null,c(){r=o("iframe"),r.src!==(n=t[1].url)&&s(r,"src",n),s(r,"frameborder","0"),s(r,"title","routify prefetcher"),this.first=r},m(e,t){i(e,r,t)},p(e,t){1&t&&r.src!==(n=e[1].url)&&s(r,"src",n)},d(e){e&&l(r)}}}function g(e){let t,r=[],n=new Map,d=e[0];const m=e=>e[1].options.prefetch;for(let t=0;t<d.length;t+=1){let o=h(e,d,t),s=m(o);n.set(s,r[t]=w(s,o))}return{c(){t=o("div");for(let e=0;e<r.length;e+=1)r[e].c();s(t,"id","__routify_iframes"),c(t,"display","none")},m(e,n){i(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,[o]){if(1&o){const s=e[0];r=f(r,o,m,1,e,s,n,t,a,w,null,h)}},i:u,o:u,d(e){e&&l(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}const b=p([]),j=m(b,(e=>e.slice(0,2)));function v(t){const r=t.data?t.data.prefetchId:t;if(!r)return null;const n=e(b).find((e=>e&&e.options.prefetch==r));if(n){const{gracePeriod:e}=n.options,t=new Promise((t=>setTimeout(t,e))),o=new Promise((t=>{window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,e+1e3)}));Promise.all([t,o]).then((()=>{b.update((e=>e.filter((e=>e.options.prefetch!=r))))}))}}function x(e,t,r){let n;return d(e,j,(e=>r(0,n=e))),[n]}j.subscribe((e=>e.forEach((({options:e})=>{setTimeout((()=>v(e.prefetch)),e.timeout)})))),addEventListener("message",v,!1);export default class extends t{constructor(e){super(),r(this,e,x,g,n,{})}}
//# sourceMappingURL=Prefetcher.svelte.js.map
