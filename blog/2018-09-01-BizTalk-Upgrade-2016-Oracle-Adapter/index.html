<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<meta http-equiv="content-security-policy" content="">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-711b4112.css">
	<link rel="modulepreload" href="/_app/start-7208c571.js">
	<link rel="modulepreload" href="/_app/chunks/vendor-5ca848cc.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-8da8bfc2.js">
	<link rel="modulepreload" href="/_app/pages/blog/_slug_.svelte-db98abb9.js">
	</head>
	<body>
		<div>



<div class="svelte-1lrvsco"><header><h1 class="svelte-1lrvsco">Mark Temple-Heald</h1>
  <h2 class="svelte-1lrvsco">the right tool for the job</h2></header>

<nav class="svelte-r02kv1"><ul class="svelte-r02kv1"><li class="svelte-r02kv1"><a href="/" class="navAnchor">Home</a></li>
    <li class="svelte-r02kv1"><a href="/blog" class="navAnchor">Blog</a></li>
    <li class="svelte-r02kv1"><a href="/topic" class="navAnchor">Topic</a></li>
    <li class="svelte-r02kv1"><a href="/about" class="navAnchor">About</a></li></ul>
</nav>
</div>

<main class="svelte-lv7236"><!-- HTML_TAG_START -->I was recently involved in an upgrade from BizTalk 2013 to BizTalk 2016.<br />After upgrade all of our SpecFlow system tests started failing.<br />The error manifests itself in the Event Viewer Application Logs as:<br /><pre class="code "><code>System.IO.FileNotFoundException: Could not load file or assembly 
'Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342' 
or one of its dependencies. The system cannot find the file specified.</code></pre><h3>Dependencies</h3>So I dug into this in order to understand the problem and how to fix it, it turns out that:<br /><ul><li>Biztalk 2013 has a dependency on <a href="https://www.oracle.com/technetwork/topics/dotnet/index-085163.html">Oracle Data Provider for .NET</a> version 11.2.  </li></ul><pre class="code poetry"><code>* Oracle version 11.2.0.x.x == Oracle.dataaccess.dll 4.112.x.x</code></pre><ul><li>BizTalk 2016 has the same dependency but on Oracle version 12.1.</li></ul><pre class="code poetry"><code>* Oracle version 12.1.0.x.x	== Oracle.dataaccess.dll 4.121.x.x</code></pre>When it comes to Oracle database connectivity:<ul><li>a newer client should be able to connect to an older database</li><li>an older client may not be able to connect to a newer database</li></ul><br />In this case the client is the oracle.dataaccess.dll library used by BizTalk, aligned to Oracle database 12.1.<br />Well that's OK then, because our target servers are running Oracle 11.2 which is older.<br />At the time of writing there are 3 download options from Oracle's site:<ul><li>DB version 11gR2  11.2.0.3.20	</li><li>DB version 12cR1  12.1.0.2.4		(closest match, only differs by minor version)</li><li>DB version 12cR2  12.2.0.1.0	</li></ul><h3>Installation</h3>After installation we end up with the following GACced assemblies:<br />``` 
C:\Windows\Microsoft.NET\assembly\GAC<em>32\Oracle.DataAccess\v4.0</em>4.121.2.0<strong>89b483f429c47342 <br />C:\Windows\Microsoft.NET\assembly\GAC<em>64\Oracle.DataAccess\v4.0</em>4.112.2.0</strong>89b483f429c47342\  
C:\Windows\Microsoft.NET\assembly\GAC<em>32\Policy.4.121.Oracle.DataAccess\v4.0</em>4.121.2.0<strong>89b483f429c47342 
```<br />The last of these provides an assembly bindingRedirect:
```XML 
<bindingRedirect oldVersion="4.121.0.0-4.121.2.0" newVersion="4.121.2.0"/> 
```<br />Great, so BizTalk's reference to oracle.dataaccess.dll 4.121.1.0 will resolve to 4.121.4.0 and all should be fine.<br />Indeed it was.<br />I'm glad I spent the time investigating this, luckily we didn't have to follow <a href="https://blog.sandro-pereira.com/2017/10/05/biztalk-server-2016-could-not-load-file-or-assembly-oracle-dataaccess-version-or-one-of-its-dependencies/">Sandro Pereira's advice</strong></a>.<br /><h3>Testing</h3>After installation we have new entries in the %PATH% environment variable: 
<code>C:\oracle\product\12.1.0\client_1</code>
<code>C:\oracle\product\12.1.0\client_1\bin</code>
<br />listed before the server installation: 
<code>C:\oraclexe\app\oracle\product\11.2.0\server\bin</code><br />This means that the client config (TNSNames.ora etc) will be used.<br />This is important for us to know.<br />Our automated system tests against a local XE 11gR2 database (an empty copy of target systems).<br />We'd like to be sure that BizTalk, our automated deployment scripts and Systests use the same client versions and configuration where possible.  <!-- HTML_TAG_END --></main>


<footer class="svelte-14g1sgx"><p>This is my site, there are many like it but this one is mine.</p>
  <p>If you don&#39;t like it, you know where the close button is.</p>
  <a href="https://www.linkedin.com/in/mtempleheald" target="_blank" class="svelte-14g1sgx">Mark Temple-Heald</a>
  <a href="https://mtempleheald.github.io" target="_blank" class="svelte-14g1sgx">Home</a>
  <a href="https://github.com/mtempleheald" target="_blank" class="svelte-14g1sgx">GitHub</a>
  <p>Mindful meanderings manifest more manageable machinations.
    Manoeuvring murky multifaceted modernism means meticulously managing many mistakes, misconceptions, misunderstandings.
    Measured multipronged musings, mechanical movements, may maximise meritorious magnificence.
  </p>
</footer>


		<script type="module" data-hydrate="xk1lxx">
		import { start } from "/_app/start-7208c571.js";
		start({
			target: document.querySelector('[data-hydrate="xk1lxx"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-8da8bfc2.js"),
						import("/_app/pages/blog/_slug_.svelte-db98abb9.js")
				],
				url: new URL("http://sveltekit-prerender/blog/2018-09-01-BizTalk-Upgrade-2016-Oracle-Adapter"),
				params: {slug:"2018-09-01-BizTalk-Upgrade-2016-Oracle-Adapter"}
			}
		});
	</script><script type="application/json" data-type="svelte-data" data-url="/api/blogs/2018-09-01-BizTalk-Upgrade-2016-Oracle-Adapter">{"status":200,"statusText":"","headers":{"content-type":"text/plain;charset=UTF-8"},"body":"I was recently involved in an upgrade from BizTalk 2013 to BizTalk 2016.  \nAfter upgrade all of our SpecFlow system tests started failing.  \n\nThe error manifests itself in the Event Viewer Application Logs as:  \n```\nSystem.IO.FileNotFoundException: Could not load file or assembly \n'Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342' \nor one of its dependencies. The system cannot find the file specified.\n```\n\n\n### Dependencies\n\nSo I dug into this in order to understand the problem and how to fix it, it turns out that:  \n* Biztalk 2013 has a dependency on [Oracle Data Provider for .NET](https:\u002F\u002Fwww.oracle.com\u002Ftechnetwork\u002Ftopics\u002Fdotnet\u002Findex-085163.html) version 11.2.  \n    * Oracle version 11.2.0.x.x == Oracle.dataaccess.dll 4.112.x.x\n* BizTalk 2016 has the same dependency but on Oracle version 12.1.\n    * Oracle version 12.1.0.x.x\t== Oracle.dataaccess.dll 4.121.x.x\n\nWhen it comes to Oracle database connectivity:\n* a newer client should be able to connect to an older database\n* an older client may not be able to connect to a newer database\n\nIn this case the client is the oracle.dataaccess.dll library used by BizTalk, aligned to Oracle database 12.1.  \nWell that's OK then, because our target servers are running Oracle 11.2 which is older.  \nAt the time of writing there are 3 download options from Oracle's site:\n* DB version 11gR2  11.2.0.3.20\t\n* DB version 12cR1  12.1.0.2.4\t\t(closest match, only differs by minor version)\n* DB version 12cR2  12.2.0.1.0\t\n\n\n### Installation\n\nAfter installation we end up with the following GACced assemblies:  \n``` \nC:\\Windows\\Microsoft.NET\\assembly\\GAC_32\\Oracle.DataAccess\\v4.0_4.121.2.0__89b483f429c47342   \nC:\\Windows\\Microsoft.NET\\assembly\\GAC_64\\Oracle.DataAccess\\v4.0_4.112.2.0__89b483f429c47342\\  \nC:\\Windows\\Microsoft.NET\\assembly\\GAC_32\\Policy.4.121.Oracle.DataAccess\\v4.0_4.121.2.0__89b483f429c47342 \n```  \nThe last of these provides an assembly bindingRedirect:\n```XML \n\u003CbindingRedirect oldVersion=\"4.121.0.0-4.121.2.0\" newVersion=\"4.121.2.0\"\u002F\u003E \n```  \nGreat, so BizTalk's reference to oracle.dataaccess.dll 4.121.1.0 will resolve to 4.121.4.0 and all should be fine.  \nIndeed it was.  \n\nI'm glad I spent the time investigating this, luckily we didn't have to follow [Sandro Pereira's advice](https:\u002F\u002Fblog.sandro-pereira.com\u002F2017\u002F10\u002F05\u002Fbiztalk-server-2016-could-not-load-file-or-assembly-oracle-dataaccess-version-or-one-of-its-dependencies\u002F).  \n\n\n### Testing\n\nAfter installation we have new entries in the %PATH% environment variable: \n`C:\\oracle\\product\\12.1.0\\client_1`\n`C:\\oracle\\product\\12.1.0\\client_1\\bin`\n  \nlisted before the server installation: \n`C:\\oraclexe\\app\\oracle\\product\\11.2.0\\server\\bin`  \n\nThis means that the client config (TNSNames.ora etc) will be used.  \n\nThis is important for us to know.  \nOur automated system tests against a local XE 11gR2 database (an empty copy of target systems).  \nWe'd like to be sure that BizTalk, our automated deployment scripts and Systests use the same client versions and configuration where possible.  \n\n"}</script></div>
	</body>
</html>
