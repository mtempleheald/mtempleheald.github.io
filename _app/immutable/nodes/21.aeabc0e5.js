import{s as J,n as q}from"../chunks/scheduler.63274e7e.js";import{S as K,i as Q,g as i,s as a,h as l,z as o,c as r,a as n,f as s}from"../chunks/index.d9809aad.js";function R(B){let h,z="Sharing environments between projects in Azure DevOps",y,p,D="This is useful for multiple websites held in different projects hosted in the same IIS instance on the same server(s). Alternatively, for microservices hosted on a Virtual Machine, if deployed independently.",g,u,E="The issue",_,f,X="Azure DevOps generates the script for you to install a build/release agent on a server, within the Environments tab of the Pipelines section of the Project.",M,c,k=`This works fine, the first time.
You can view the results of this in the DevOps portal <code>https://dev.azure.com/&lt;Team&gt;/_settings/deploymentPools</code>.
The default names for Deployment Groups (used by releases) is <code>&lt;Project&gt;-&lt;Environment&gt;</code>.
The default names for Environments (used by pipelines) is <code>environment-&lt;environment-id&gt;-&lt;guid&gt;</code>.
These names can be changed to aid ongoing maintenance.`,H,d,N="If you try to create a second agent on the same VM, in the same way, it will do one of 2 things:",L,m,V=`<li>Overwrite the first, meaning that any pipelines which reference this will cease to function</li> <li>Fail to create since it can’t delete the first agent.
In this case the second agent always shows as offline and the new pipeline won’t run.
<code>Unable to deploy to the virtual machine &#39;XXX&#39; as the machine is offline</code></li>`,P,v,F='Others have reported <a href="https://github.com/MicrosoftDocs/azure-devops-docs/issues/8578" rel="nofollow">this issue</a> and provided an alternative script. I am not comfortable just running scripts from the web, I prefer a future proof understanding of the problem.',j,w,U="The solution",I,x,G=`The reason for this issue is that the script generates an agent with a name matching the VM by default.
The DevOps-generated script is one-lined but otherwise not hard to dissect.
In the line which calls <code>config</code> we need to change the <code>agent</code> parameter to something unique, either by appending the agent folder (<code>$destFolder</code> in the script), e.g. HOSTNAME-A3, or with something which indicates the purpose of this agent, e.g. HOSTNAME-ServiceX or HOSTNAME-WebsiteX, in which case we should probably update the script to create a folder name to match this.`,O,C,W="The future",A,b,Y='A <a href="https://developercommunity.visualstudio.com/t/can-environments-be-shared-across-team-projects/676255" rel="nofollow">proposal</a> has been made to Microsoft to allow environment sharing but doesn’t seem active.',S,T,$='Interestingly this was <a href="https://devblogs.microsoft.com/devops/sharing-of-deployment-groups-across-projects/" rel="nofollow">resolved</a> in the past for deployment groups, which are used by releases (as opposed to pipelines), so I’d assume that this will come eventually.';return{c(){h=i("h1"),h.textContent=z,y=a(),p=i("p"),p.textContent=D,g=a(),u=i("h2"),u.textContent=E,_=a(),f=i("p"),f.textContent=X,M=a(),c=i("p"),c.innerHTML=k,H=a(),d=i("p"),d.textContent=N,L=a(),m=i("ul"),m.innerHTML=V,P=a(),v=i("p"),v.innerHTML=F,j=a(),w=i("h2"),w.textContent=U,I=a(),x=i("p"),x.innerHTML=G,O=a(),C=i("h2"),C.textContent=W,A=a(),b=i("p"),b.innerHTML=Y,S=a(),T=i("p"),T.innerHTML=$},l(e){h=l(e,"H1",{"data-svelte-h":!0}),o(h)!=="svelte-bb1m4l"&&(h.textContent=z),y=r(e),p=l(e,"P",{"data-svelte-h":!0}),o(p)!=="svelte-mmpop6"&&(p.textContent=D),g=r(e),u=l(e,"H2",{"data-svelte-h":!0}),o(u)!=="svelte-1qwlvvu"&&(u.textContent=E),_=r(e),f=l(e,"P",{"data-svelte-h":!0}),o(f)!=="svelte-6vjq4x"&&(f.textContent=X),M=r(e),c=l(e,"P",{"data-svelte-h":!0}),o(c)!=="svelte-1gauxpm"&&(c.innerHTML=k),H=r(e),d=l(e,"P",{"data-svelte-h":!0}),o(d)!=="svelte-zbwpnm"&&(d.textContent=N),L=r(e),m=l(e,"UL",{"data-svelte-h":!0}),o(m)!=="svelte-1ohkpg5"&&(m.innerHTML=V),P=r(e),v=l(e,"P",{"data-svelte-h":!0}),o(v)!=="svelte-outdpg"&&(v.innerHTML=F),j=r(e),w=l(e,"H2",{"data-svelte-h":!0}),o(w)!=="svelte-fem3ok"&&(w.textContent=U),I=r(e),x=l(e,"P",{"data-svelte-h":!0}),o(x)!=="svelte-1q6fsiv"&&(x.innerHTML=G),O=r(e),C=l(e,"H2",{"data-svelte-h":!0}),o(C)!=="svelte-82q5qk"&&(C.textContent=W),A=r(e),b=l(e,"P",{"data-svelte-h":!0}),o(b)!=="svelte-1dchy4b"&&(b.innerHTML=Y),S=r(e),T=l(e,"P",{"data-svelte-h":!0}),o(T)!=="svelte-12js8r5"&&(T.innerHTML=$)},m(e,t){n(e,h,t),n(e,y,t),n(e,p,t),n(e,g,t),n(e,u,t),n(e,_,t),n(e,f,t),n(e,M,t),n(e,c,t),n(e,H,t),n(e,d,t),n(e,L,t),n(e,m,t),n(e,P,t),n(e,v,t),n(e,j,t),n(e,w,t),n(e,I,t),n(e,x,t),n(e,O,t),n(e,C,t),n(e,A,t),n(e,b,t),n(e,S,t),n(e,T,t)},p:q,i:q,o:q,d(e){e&&(s(h),s(y),s(p),s(g),s(u),s(_),s(f),s(M),s(c),s(H),s(d),s(L),s(m),s(P),s(v),s(j),s(w),s(I),s(x),s(O),s(C),s(A),s(b),s(S),s(T))}}}class te extends K{constructor(h){super(),Q(this,h,null,R,J,{})}}export{te as component};
